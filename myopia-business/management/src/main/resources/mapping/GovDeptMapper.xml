<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wupol.myopia.business.management.domain.mapper.GovDeptMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.wupol.myopia.business.management.domain.model.GovDept">
    </resultMap>
    <resultMap id="GovDeptVo" type="com.wupol.myopia.business.management.domain.vo.GovDeptVo">
    </resultMap>

    <!-- 通用查询条件 -->
    <sql id="Base_Where_Clause">
        <where>
            <trim prefixOverrides="and">
                <if test="@Ognl@isNotEmpty(id)">and `id` = #{id}</if>
                <if test="@Ognl@isNotEmpty(name)">and `name` = #{name}</if>
                <if test="@Ognl@isNotEmpty(pid)">and `pid` = #{pid}</if>
                <if test="@Ognl@isNotEmpty(districtId)">and `district_id` = #{districtId}</if>
                <if test="@Ognl@isNotEmpty(createUserId)">and `create_user_id` = #{createUserId}</if>
                <if test="@Ognl@isNotEmpty(status)">and `status` = #{status}</if>
                <if test="@Ognl@isNotEmpty(remark)">and `remark` = #{remark}</if>
                <if test="@Ognl@isNotEmpty(createTime)">and `create_time` = #{createTime}</if>
                <if test="@Ognl@isNotEmpty(updateTime)">and `update_time` = #{updateTime}</if>
            </trim>
        </where>
    </sql>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, name, pid, district_id, create_user_id, status, remark, create_time, update_time
    </sql>

    <resultMap id="treeVoMap" type="com.wupol.myopia.business.management.domain.model.GovDept">
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="pid" property="pid" jdbcType="INTEGER" />
        <collection property="child" ofType="com.wupol.myopia.business.management.domain.model.GovDept" column="{pid=id}" select="selectGovDeptTreeByPid"/>
    </resultMap>

    <!--级联查询部门树-->
    <select id="selectGovDeptTreeByPid" resultMap="GovDeptVo" >
        select gd.*, d.name as districtName
        from m_government_department gd
        left join m_district d ON gd.district_id = d.id
        where pid = #{pid}
    </select>

    <resultMap id="idTreeMap" type="com.wupol.myopia.business.management.domain.model.GovDept">
        <id column="id" property="id" jdbcType="INTEGER" />
        <collection property="child" ofType="com.wupol.myopia.business.management.domain.model.GovDept" column="{pid=id}" select="selectIdTreeByPid"/>
    </resultMap>

    <!-- 级联查询部门ID树 -->
    <select id="selectIdTreeByPid" resultMap="idTreeMap" >
        select id from m_government_department where pid = #{pid}
    </select>

</mapper>
